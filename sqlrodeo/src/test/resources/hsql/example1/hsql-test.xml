<?xml version="1.0"?>
<sql-rodeo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://www.example.org/SqlRodeoSchema" xsi:schemaLocation="http://www.example.org/SqlRodeoSchema SqlRodeoSchema.xsd">

	<properties href="props.properties" />
	<properties href="hsql-datasource.properties" />

	<properties>
		c=3
		d=4
	</properties>
	<properties />

	<!-- TODO: Meaningful to have more than 1 connection for a HSQLDB db? -->
	<datasource id="myConnectionDatasource" name="${hsql_db_name}"
		maxTotal="${hsql_db_maxTotal}" maxIdle="${hsql_db_maxIdle}" maxWaitMillis="${hsql_db_maxWaitMillis}"
		url="${hsql_db_url}" username="${hsql_db_username}" password="${hsql_db_password}" />

	<connection id="myConnection" datasource-id="myConnectionDatasource" />

	<assign id="initialRelease" value="0" />
	<assign id="initialBuild" value="0" />

	<delegate id="myDelegate" delegate-class="sqlrodeo.DoNothingDelegate">
		Hello delegate!
	</delegate>


	<query connection-id="myConnection" rowcount="versionTableCount">
		SELECT table_name
		from
		INFORMATION_SCHEMA.SYSTEM_TABLES WHERE table_name =
		'SCHEMA_VERSION'
	</query>

	<sql connection-id="myConnection" if="versionTableCount == 0">
		CREATE TABLE SCHEMA_VERSION (
		release INT NOT NULL,
		build INT NOT NULL,
		created DATE DEFAULT SYSDATE
		NOT NULL,
		PRIMARY KEY (release, build));

		INSERT INTO
		SCHEMA_VERSION(release, build)
		VALUES (${initialRelease},
		${initialBuild});
	</sql>
	<!-- <commit id="myConnection"/> -->

	<!-- Determine DB version -->
	<query connection-id="myConnection" publish-as="release">
		SELECT
		MAX(release) as release FROM SCHEMA_VERSION
	</query>

	<query connection-id="myConnection" publish-as="build">
		SELECT MAX(build)
		as build FROM
		SCHEMA_VERSION WHERE release = ${release}
	</query>

	<include if="release le 1" href="release1.xml" />
	<commit id="myConnection" />

	<exit></exit>

</sql-rodeo>